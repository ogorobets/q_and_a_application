angular.module('npAdmin').controller('SeparateQuestionCtrl', ['$scope',  '$http', '$stateParams', '$location',
    '$cookies', function($scope, $http, $stateParams, $location, $cookies) {
    $http.get('/get-separate-question', { params: {questionId: $stateParams.id} }).
        then(function(response) {
            console.log('111', response);

            $scope.title = response.data.separateQuestion.title;
            $scope.questionBody = response.data.separateQuestion.question_body;
            $scope.answersAmount = response.data.separateQuestion.answer_ids.length;
            $scope.answerObjs = response.data.answersText

        }, function(response) {
            // errors
            console.log('ERROR: ', response);
        });

    $scope.addAnswer = function() {
        var userObj = $cookies.getObject('userName');
        if (!userObj || !userObj.username) {
            $location.url('/login');
        }

        data = {
            answerText: $scope.answerText,
            questionId: $stateParams.id,
            authorId: userObj._id,
            userName: userObj.username
        };

        $scope.answerText = '';
        $http.put('/add-answer', data).
            then(function(response) {
                $http.get('/get-separate-question', { params: {questionId: $stateParams.id} }).
                    then(function(response) {
                        $scope.answersAmount = response.data.separateQuestion.answer_ids.length;
                        $scope.answerObjs = response.data.answersText;
                    }, function(response) {
                        // errors
                        console.log('ERROR: ', response);
                    });
                console.log(response);
            }, function(response) {
                // errors
                console.log('ERROR: ', response);
            });
    }
}]);