'use strict';

module.exports = ['$scope',  '$http', '$stateParams', '$location', '$cookies', 'IoOperations',
    function($scope, $http, $stateParams, $location, $cookies, IoOperations) {
    IoOperations.send('get-separate-question', { questionId: $stateParams.id }, function(response) {
        console.log('111', response);

        $scope.title = response.separateQuestion.title;
        $scope.questionBody = response.separateQuestion.question_body;
        $scope.answersAmount = response.separateQuestion.answer_ids.length;
        $scope.answerObjs = response.answersText

    }, function(response) {
        // errors
        console.log('ERROR: ', response);
    });

    $scope.addAnswer = function() {
        var userObj = $cookies.getObject('userName');
        if (!userObj || !userObj.username) {
            $location.url('/login');
        }

        var data = {
            answerText: $scope.answerText,
            questionId: $stateParams.id,
            authorId: userObj._id,
            userName: userObj.username
        };

        $scope.answerText = '';
        IoOperations.send('add-answer', data, function(response) {
            IoOperations.send('get-separate-question', { questionId: $stateParams.id }, function(response) {
                $scope.answersAmount = response.separateQuestion.answer_ids.length;
                $scope.answerObjs = response.answersText;
            }, function(response) {
                // errors
                console.log('ERROR: ', response);
            });
            console.log(response);
        }, function(response) {
            // errors
            console.log('ERROR: ', response);
        });
    }
}];