'use strict';

window.angular = require('angular');
require('../../public/js/app.js');
require('angular-mocks');
require('angular-socket.io-mock');

/* jasmine specs for controllers go here */
describe('npAdmin controllers', function () {

    beforeEach(angular.mock.module('npAdmin'));

    beforeEach(function () {
        jasmine.addMatchers({
            toEqualData: function (util, customEqualityTesters) {
                return {
                    compare: function (actual, expected) {
                        return {
                            pass: angular.equals(actual, expected)
                        };
                    }
                };
            }
        });
    });

    describe('AllQuestionsCtrl', function () {
        var scope, socket, socketFactory, ctrl;
        var questionsInitData = function () {
            return [{
                _id: 1,
                answer_ids: [1111, 2222],
                title: 'question 1',
                tags: ['ANSI C', 'C++'],
                author: {user_name: 'Jack'}
            },
            {
                _id: 2,
                answer_ids: [3333, 4444],
                title: 'question 2',
                tags: ['JS', 'CSS'],
                author: {user_name: 'Jim'}
            }];
        };

        var allQuestionsData = function () {
            return [{
                _id: 1,
                answersAmount: 2,
                summary: 'question 1',
                tags: ['ANSI C', 'C++'],
                author: 'Jack'
            },
            {
                _id: 2,
                answersAmount: 2,
                summary: 'question 2',
                tags: ['JS', 'CSS'],
                author: 'Jim'
            }];
        };

        var stateParams = {questionsType: 'all'};

        beforeEach(inject(function (_socketFactory_, $rootScope, $controller) {
            // $httpBackend = _$httpBackend_;
            // $httpBackend.expectGET('/get-questions').respond(200, questionsInitData());
            socketFactory = _socketFactory_;
            socket = new socketFactory();
            scope = $rootScope.$new();
            ctrl = $controller('AllQuestionsCtrl', {$scope: scope, $stateParams: stateParams});
        }));

        it('should fetch all questions data', function () {
            expect(scope.questions).toBeUndefined();
            // $httpBackend.flush();

            // Should be fixed. Correct mock for websocket is needed.
            //socket.receive('get-questions', questionsInitData())
            //expect(scope.questions).toEqualData(allQuestionsData());
        });
    });
});